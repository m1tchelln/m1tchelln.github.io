<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Messaging App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffffff;
      color: #000000;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }
    #messages {
      border: 1px solid #ccc;
      padding: 10px;
      height: 300px;
      overflow-y: scroll;
      background-color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
    }
    body.dark-mode #messages {
      background-color: #1e1e1e;
      border-color: #333333;
    }
    #messageForm {
      margin-top: 10px;
    }
    #darkModeToggle {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Simple Messaging App</h1>
  <button id="darkModeToggle">Toggle Dark Mode</button>
  <div id="messages"></div>
  <form id="messageForm">
    <input type="text" id="messageInput" placeholder="Type your message...">
    <button type="submit">Send</button>
  </form>

  <script>
    const ws = new WebSocket(`ws://${window.location.host}`);
    const messagesDiv = document.getElementById('messages');
    const messageForm = document.getElementById('messageForm');
    const messageInput = document.getElementById('messageInput');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const commands = {
        changename: "$changename "
    }
    let clientName = null;

    ws.onmessage = function(event) {
        const message = JSON.parse(event.data);
        if (!clientName) {
            clientName = message.str;
        } else {
            const messageElement = document.createElement('p');
            messageElement.textContent = message.str;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    };

    messageForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const message = {str: messageInput.value};
        if (message.str.trim() === '') return;
        message.str = `${clientName}: ${message.str}`;
        ws.send(JSON.stringify(message));
        if (message.str.includes(commands.changename)) {
            clientName = message.str.slice(message.str.indexOf(commands.changename) + commands.changename.length);
        }
        messageInput.value = '';
    });

    darkModeToggle.addEventListener('click', function() {
      document.body.classList.toggle('dark-mode');
      // Optionally save dark mode preference in localStorage
      if (document.body.classList.contains('dark-mode')) {
        localStorage.setItem('darkMode', 'enabled');
      } else {
        localStorage.removeItem('darkMode');
      }
    });

    // Load dark mode preference from localStorage
    if (localStorage.getItem('darkMode') === 'enabled') {
      document.body.classList.add('dark-mode');
    }
  </script>
</body>
</html>
